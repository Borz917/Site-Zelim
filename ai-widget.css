// ===== AI WIDGET (HTML + interactions) =====
(function () {
  // EmpÃªche double injection si le script est chargÃ© 2 fois
  if (document.querySelector(".ai-bubble") || document.querySelector(".ai-panel")) return;

  // Injecte le widget dans la page
  const bubble = document.createElement("button");
  bubble.className = "ai-bubble";
  bubble.type = "button";
  bubble.textContent = "AI";

  const panel = document.createElement("div");
  panel.className = "ai-panel";
  panel.id = "aiPanel";

  panel.innerHTML = `
    <div class="ai-top">
      <span>Assistant IA</span>
      <button class="ai-close" type="button" id="aiClose">Fermer</button>
    </div>

    <div class="ai-messages" id="aiMessages">
      <div class="ai-msg">Salut ðŸ‘‹ Ã‰cris-moi un message.</div>
    </div>

    <div class="ai-input">
      <input id="aiText" type="text" placeholder="Ã‰cris ici..." autocomplete="off" />
      <button id="aiSend" type="button">Envoyer</button>
    </div>
  `;

  document.body.appendChild(bubble);
  document.body.appendChild(panel);

  // Elements
  const closeBtn = panel.querySelector("#aiClose");
  const sendBtn = panel.querySelector("#aiSend");
  const input = panel.querySelector("#aiText");
  const messages = panel.querySelector("#aiMessages");

  function openPanel() {
    panel.style.display = "block";
    input.focus();
  }

  function closePanel() {
    panel.style.display = "none";
  }

  function addMsg(text, isUser) {
    const div = document.createElement("div");
    div.className = "ai-msg" + (isUser ? " ai-user" : "");
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function send() {
    const text = (input.value || "").trim();
    if (!text) return;

    addMsg(text, true);
    input.value = "";

    // RÃ©ponse placeholder (tu pourras brancher une vraie IA plus tard)
    setTimeout(() => {
      addMsg("Bien reÃ§u âœ… (version dÃ©mo).", false);
    }, 350);
  }

  // Events
  bubble.addEventListener("click", () => {
    if (panel.style.display === "block") closePanel();
    else openPanel();
  });

  closeBtn.addEventListener("click", closePanel);

  sendBtn.addEventListener("click", send);

  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") send();
    if (e.key === "Escape") closePanel();
  });
/* Disabled propre (sinon rendu bizarre selon style.css) */
.ai-panel .ai-input input:disabled{
  background: #f1f5f9 !important;
  color: #64748b !important;
  cursor: not-allowed !important;
  opacity: 1 !important;
}

.ai-panel .ai-input button:disabled{
  opacity: .6 !important;
  cursor: not-allowed !important;
}

  /* FORCER le widget Ã  rester flottant */
.ai-panel{
  position: fixed !important;
  right: 18px !important;
  bottom: 86px !important;
  width: 360px !important;
  max-width: calc(100vw - 36px) !important;
  height: 460px !important;
  display: none !important;
  z-index: 999999 !important;
}

.ai-bubble{
  position: fixed !important;
  right: 18px !important;
  bottom: 18px !important;
  z-index: 999999 !important;
}

})();
